{% extends "header.html" %}

{% block content %}

{% if session['logged_in'] %}
<main role="main" class="container-fluid container-md bg-white px-4 shadow-sm">
	<div class="publicar collapse" id="demo1">
		<form action="/crearPublicacion" method="POST">
			<input type="text" id="titulo" name="titulo" maxlength="120" placeholder="Título...">

			<label for="personaje-select " style="display: block;">Personaje:</label>


			<select name="personaje" class="selectpicker mb-2 mr-2" title="Seleccione un personaje..." data-size="5"
				data-live-search="true" data-style="btn-outline-dark">
				{%for task in tasks1%}
				<option value="{{task.nombre}}">{{task.nombre}}</option>
				{%endfor%}
			</select>
			<a href="crear-perso" class="btn btn-outline-dark mb-2 py-1" data-toggle="tooltip" data-placement="right"
				title="Puede crear un nuevo personaje si no encuentra el deseado">Nuevo</a>


			<label for="fecha" id="lblfecha">Fecha </label>
			<input type="date" id="fecha" name="fecha">

			<textarea name="descripcion" id="descripcion" maxlength="1000" placeholder="Describe el acontecimiento..."></textarea>
			<label for="referencias">Fuente(s): </label>
			<textarea name="referencias" id="referencias" maxlength="400" placeholder="Referencias, citas, enlaces, etc..."></textarea>
			<button type="submit" class="btn btn-dark boton">Publicar</button>
		</form>
	</div>
	<div title="Nueva Publicación" class="d-flex align-content-center justify-content-center">
		<button data-toggle="collapse" data-target="#demo1" class="btn btn-outline-dark collapsed nuevaPubliBtn px-5"
			aria-expanded="false" aria-controls="demo1"><i class="fa fa-lg" aria-hidden="true"></i></button>
	</div>

	{% else %}
	<div class="container-fluid row m-0 p-0 px-2 bienvenida" data-ride="carousel">
		<div class="col-md-6 carousel slide" id="myCarousel">
			<ul class="carousel-indicators">
				<li class="item1 active"></li>
				<li class="item2"></li>
				<li class="item3"></li>
			</ul>

			<!-- The slideshow -->
			<div class="carousel-inner">
				<div class="carousel-item active">
					<img src="../static/img/foto_Julio Guzman.jpg" alt="">
					<div class="carousel-caption d-md-block">
						<h5>Julio Guzmán</h5>
						<p>El líder del Partido Morado es conocido por su "tibiez" al momento de emitir opiniones sobre
							algún aspecto.
							Esta característica suya le ha pasado factura en múltiples situaciones, la más reconocida es
							tal vez el incidente del incendio.
						</p>
					</div>
				</div>
				<div class="carousel-item">
					<img src="../static/img/Vizcarra2.jpg" alt="">
					<div class="carousel-caption d-md-block">
						<h5>Martín Vizcarra</h5>
						<p>El actual presidente de la República no está exento de inculpaciones desfavorables a su
							imagen política.
							Sus opositores suelen atribuirle actos de corrupción y conflictos de interés.</p>
					</div>
				</div>
				<div class="carousel-item">
					<img src="../static/img/Keiko.jpg" alt="">
					<div class="carousel-caption d-md-block">
						<h5>Keiko Fujimori</h5>
						<p>La lideresa de Fuerza Popular tiene múltiples acusaciones y ha estado en prisión preventiva
							dos veces.
							Se le imputan actos de corrupción relacionados al dinero recibido por diversas entidades
							empresariales.
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 d-flex align-items-center pb-4 pt-4">
			<div class="container-fluid d-flex justify-content-center flex-column" style="color: #ccc;">
				<h1 style="display: flex; justify-content: center; font-family: Arvo, serif;">¡Bienvenido!</h1>
				<p style="text-align: center;">
					Esta es una página donde puedes ver acontecimientos relacionados a políticos o personajes públicos.
					Estas publicaciones son realizadas por la ciudadanía y tú puedes ser partícipe de ello. <br>
					<b>Memorex tiene como objetivo que el ciudadano no olvide. Nace ante la necesidad de recordar todo
						lo relacionado a personajes vinculados a nuestra política.</b>
				</p>
				<div class="btn-group boton-sec col-12 m-0 p-0 d-flex justify-content-center w-100">
					<a href="login"><button class="btn btn-secondary"><i
								class="fas fa-sign-in-alt mr-2"></i>Acceder</button></a>
					<a href="sign-up"><button class="btn btn-danger"><i
								class="fas fa-user mr-2"></i>Registrarse</button></a>
				</div>
			</div>
		</div>
	</div>
	<main role="main" class="container-fluid container-md bg-white px-4 shadow-sm">



		{% endif %}

		{% for task in tasks%}
		<div class="publicacion">

			<div>
				<img src="/static/img/foto_{{task.username}}.jpg" alt="" class="img-usuario rounded-circle">
				<span class="username-publi pl-2"> {{task.username}}</span>
				
				{% if session['logged_in'] %}
				<button type="button" data-toggle="modal" data-target="#modalReporte{{task.id}}"
					class="btn float-right">
					<i class="far fa-flag" data-toggle="tooltip" data-placement="top" title="Reportar"
						style="color: rgb(168, 0, 0);"></i>
				</button>
				<button type="button" class="btn btn-outline-danger float-right" data-toggle="modal" 
					data-target="#myModal-Eliminar{{task.id}}" title="Eliminar Personaje">
					<i class="far fa-trash-alt"></i>
				</button>
				<button type="button" class="btn btn-outline-dark float-right" data-toggle="modal" 
				data-target="#myModal-Modificar{{task.id}}" title="Modificar Publicacion"><i class="fa fa-pen"></i><span class="sr-only">Modificar</span>
				</button>
				{% endif %}

			</div>
			<div class="container">

				<!-- Modal Reporte-->

				<div class="modal fade" id="modalReporte{{task.id}}">
					<div class="modal-dialog">
						<div class="modal-content bg-light" style="color: #000;">
							<div class="modal-header">

								<h4 class="modal-title" style="font-size: 1.1em; font-weight: 700;">¿Por qué razón
									sientes que esta publicación debe ser
									reportada?</h4>
								<button type="button" class="close" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">

								<form method="post" action="{{ url_for('report') }}?action=report&postType=post&postId={{task.id}}">
									<div class="form-check">
										  <label class="form-check-label" for="radio1">
											<input type="radio" class="form-check-input" id="radio1" name="optradio" value="Duplicado" checked>Duplicado
										  </label>
									</div>
									<div class="form-check">
										  <label class="form-check-label" for="radio2">
											<input type="radio" class="form-check-input" id="radio2" name="optradio" value="Malintencionado">Malintencionado
										  </label>
									</div>
									<div class="form-check">
										  <label class="form-check-label" for="radio3">
											<input type="radio" class="form-check-input" id="radio3" name="optradio" value="Irrelevante">Irrelevante
										  </label>
									</div>
									<div class="form-check">
										  <label class="form-check-label" data-toggle="collapse" data-target="#demo" for="radio4">
											<input type="radio" class="form-check-input" id="radio4" name="optradio" value="Other">Otro:
										  </label>
									   <div id="demo" class="collapse">
									<div class="form-group">
										  <textarea class="form-control" rows="5" id="other_text" name="other_text"></textarea>
									</div>
									</div>
									</div>
									<br>
									<button type="submit" class="btn btn-dark">Reportar</button>
								</form>
						</div>
					</div>
				</div>
			</div>
			</div>

			<!-- MODAL MODIFICAR PUBLI -->

			<div class="modal fade" id="myModal-Modificar{{task.id}}">
				<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content">
				
					
					<div class="modal-header">
						<h4 class="modal-title" style="font-size: 1.1em; font-weight: 700;">Modificar Personaje</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					
					<div class="modal-body publicar">
						<form action="/editarPublicacion/{{task.id}}" method="POST"  class="publicar">	
							<input type="text" id="titulo" name="titulo" maxlength="120" value="{{task.titulo}}" style="width: 80%;" placeholder="Título...">

							<label for="personaje-select " style="display: block;">Personaje:</label>


							<select name="personaje" class="selectpicker mb-2 mr-2" data-size="5"
								data-live-search="true" data-style="btn-outline-dark">
								
								{%for task1 in tasks1%}
									
									{% if task.personaje == task1.nombre %}
									<option value="{{task1.nombre}}" selected>{{task1.nombre}}</option>
									{% else %}
									<option value="{{task1.nombre}}">{{task1.nombre}}</option>
									{% endif %}
								{%endfor%}
							</select>
							<label for="fecha" id="lblfecha">Fecha </label>
							<input type="date" id="fecha" value="{{task.fecha}}" name="fecha">

							<textarea name="descripcion" id="descripcion" maxlength="1000" placeholder="Describe el acontecimiento...">{{task.contenido}}</textarea>
							<label for="referencias">Fuente(s): </label>
							<textarea name="referencias" id="referencias" maxlength="400" placeholder="Referencias, citas, enlaces, etc...">{{task.fuente}}</textarea>

							<button type="submit" class="btn btn-dark">Modificar</button>
						</form>
					</div>
				</div>
				</div>
			</div>

			<!-- FIN MODAL MODIFICA PUBLI -->

			<!-- The Modal Eliminar Publi-->

			<div class="modal fade" id="myModal-Eliminar{{task.id}}">
				<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
				
					
					<div class="modal-header">
						<h4 class="modal-title" style="font-size: 1.1em; font-weight: 700;">¿Está seguro que desea eliminar la publicación?</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					
					
					<div class="modal-body">
						<form method="post" action="{{ url_for('report') }}?action=delete&postType=post&postId={{ task.id }}" class="crear-perso d-flex justify-content-around" enctype="multipart/form-data">
							<a type="" data-dismiss="modal" style="color: #eee;" class="btn btn-dark">Cancelar</a>
							<button type="submit" class="btn btn-outline-danger">Eliminar</button>
						</form>
					</div>
				</div>
				</div>
			</div>

			<!-- Fin The Modal Eliminar publi-->

			<div class="row m-0 p-0">
				<div class="col-8 m-0 p-0" style="color: #000;">
					<h3 style="font-family: 'Roboto Slab';">{{task.titulo}}</h2>
						<span class="fecha-lbl">
							Fecha de publicación: <span class="fecha-publi">{{task.fecha}}</span>
						</span>
				</div>
				<div class="col-4 m-0 p-0">
					<div class="publi-body-col2">
						<img class="rounded-circle" src="static/img/foto_{{task.personaje}}.jpg"
							alt="{{task.personaje}}">
						<span class="nombre-perso pl-2">
							{{task.personaje}}
						</span>
					</div>
				</div>

			</div>


			<div class="media m-0 p-0" style="align-items: center;">
				<div class="media-body publi-body-col1">

					<div class="info-publi">
						{{task.contenido}}
					</div>
				</div>


			</div>
			<div class="fuente-publi m-0 p-0 mb-3">
				<div class="col-12 p-0">
					<span class="fuentes-lbl">Fuente(s):</span>
					<a href="{{task.fuente}}">{{task.fuente}}</a>
				</div>
				<br>

				<!---->

				<button type="button" class="btn btn-dark mb-2 collapsed" data-toggle="collapse"
                    data-target="#comments{{task.id}}" aria-expanded="false">Comentarios <i class="far fa-comments fa-lg"
                        style="color: rgb(226, 226, 226);" aria-hidden="true"></i></button>
                <div id="comments{{task.id}}" class="collapse" >
                    
                    <form action="" method="" id="commentform" class="comment-form" novalidate="">
                        <div class="comment-form-input-wrap td-form-comment">
                            <textarea placeholder="Escriba su comentario..." id="comment" class="form-control" name="comment"
                                 rows="3" maxlength="400" required></textarea>
                        </div>
            
                        <br>
                        <button type="submit" class="btn btn-outline-dark">Publicar comentario</button>
                        <br>

                        <div class="media">
                            <div class="media-left media-top">
                                <img src="../static/img/CerebroMemorex.jpg" class="media-object" style="width:80px">
                            </div>
                            <div class="media-body">
                                <span class="username-publi pl-2"> Jhon Marco Salcedo Alfaro</span>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua.</p>
                            </div>
                        </div>
                        <br>
                    </form>

                </div>



			</div>
		</div>
		
		{% endfor %}

		<!--paginacion-->

		<ul class="pagination pagination-sm justify-content-end py-3">
			{% if prev_url %}
			<li class="page-item"><a title="Anterior" class="page-link btn" href="{{ prev_url }}"><i
						class="fas fa-chevron-left"></i></a></li>
			{% else %}
			<li class="page-item"><a title="Anterior" class="page-link btn disabled" href="#"><i
						class="fas fa-chevron-left"></i></a></li>
			{% endif %}

			{%for page in paginacion.iter_pages() %}
			{% if page %}
			<li class="page-item"><a title="{{page}}" class="page-link btn" href="{{page}}">{{page}}</a></li>
			{% endif %}
			{% endfor %}

			{% if next_url %}
			<li class="page-item"><a title="Siguiente" class="page-link btn" href="{{ next_url }}"><i
						class="fas fa-chevron-right"></i></a></li>

			{% endif %}
		</ul>

		<!---->

	</main>

	<script>
		$(document).ready(function () {

			// Activate Carousel

			$("#myCarousel").carousel();

			// Enable Carousel Indicators
			
			$(".item1").click(function () {
				$("#myCarousel").carousel(0);
			});
			$(".item2").click(function () {
				$("#myCarousel").carousel(1);
			});
			$(".item3").click(function () {
				$("#myCarousel").carousel(2);
			});
		});
	</script>

	{% endblock %}